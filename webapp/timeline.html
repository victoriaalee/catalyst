<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href='http://fonts.googleapis.com/css?family=Droid+Serif|Open+Sans:400,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="vertical-timeline/css/reset.css"> <!-- CSS reset -->
	<link rel="stylesheet" href="vertical-timeline/css/style.css"> <!-- Resource style -->
	<script src="vertical-timeline/js/modernizr.js"></script> <!-- Modernizr -->
	
	<title>Patient Timeline</title>
</head>
<body>
	<header>
		<h1 id="headline">Responsive Vertical Timeline</h1>


	</header>
	
	</header>
	</header>
	<section>
		<ul>
			<li class="nav"><a href="#timeline">Timeline</a></li>
			<li class="nav"><a href="#background">Background</a></li>
			<li class="nav"><a href="#data">Data</a></li>
		</ul>
	<a name="timeline"/>

	
	</section>
	

	<section id="cd-timeline" class="cd-container">

		
	</section> 
	<a name="background"/>

	<a name="data"/>
	
	<!-- cd-timeline -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="vertical-timeline/js/main.js"></script> <!-- Resource jQuery -->
<script src="js/util.js"></script>
<script src="js/fhir.js"></script>
<script src="vertical-timeline/js/timeline.js"></script>
<script>
	var url = "http://fhir2.healthintersections.com.au/open";
	var patientID = "ad2f3d7c-4274-4422-a10a-8e2bc99c40";
	//var patientID = "example";
	
	var timeline = document.getElementById("cd-timeline");
	var patient = searchPatientID(url, patientID);
	var obs = searchResourcePatient(url, "Observation", patient);
	var patientName = patient.name[0].given[0] + " " + patient.name[0].family[0];
	changeHeader(patientName);
	for(i = 0; i < obs.length; i++)
	{
		var block = blockGen(generateContent(obs[i]));
		timeline.appendChild(block);
	}

	var enc = searchResourcePatient(url, "Encounter", patient);
	for(i = 0; i < enc.length; i++)
	{
		var block = blockGen(generateContent(enc[i]));
		timeline.appendChild(block);
	}

	function changeHeader(newTitle)
	{
		document.getElementById("headline").innerHTML = newTitle;
	}

	//Generates a block based on the content strings
	function blockGen(contentStr)
	{
		var titleArray = contentStr.match("<e>(.+?)<\/e>");
		var contentArray = contentStr.match("<n>(.+?)<\/n>");
		var dateArray = contentStr.match("<t>(.+?)<\/t>");
		var title = titleArray!=null?titleArray[0]:"";
		var content = contentArray!=null?contentArray[0]:"";
		var date = dateArray!=null?dateArray[0]:"";
		return generateBlock(title,content,date);
	}
</script>
</body>
</html>