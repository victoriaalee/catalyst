<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href='http://fonts.googleapis.com/css?family=Droid+Serif|Open+Sans:400,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="vertical-timeline/css/reset.css"> <!-- CSS reset -->
	<link rel="stylesheet" href="vertical-timeline/css/style.css"> <!-- Resource style -->
	<script src="vertical-timeline/js/modernizr.js"></script> <!-- Modernizr -->
	
	<title>Patient Timeline</title>
</head>

<body>
	<header>
		<h1 id="headline">Responsive Vertical Timeline</h1>
	</header>	
	</header>
	</header>
		<ul>
			<li class="nav"><a href="#timeline">Timeline</a></li>
			<li class="nav"><a href="#background">Background</a></li>
			<li class="nav"><a href="#data">Data</a></li>
		</ul>


	<a name="timeline"/>
	<div class="fillerbox"></div>
	<div class="section_header">Timeline</div>
		<p class="data_input">Keyword:</p>
	<input class="data_input" type="text" name="keyword">
	<section id="cd-timeline" class="cd-container">

		
	</section> 
	<a name="background"/>
	<div class="section_header">Background</div>
	<a name="data"/>
	<div class="section_header">Patient Data</div>
		<p class="data_input">Keyword:</p>
	<input class="data_input" type="text" name="keyword">
	<!-- cd-timeline -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="vertical-timeline/js/main.js"></script> <!-- Resource jQuery -->
<script src="js/util.js"></script>
<script src="js/fhir.js"></script>
<script src="vertical-timeline/js/timeline.js"></script>
<script>
	var url = "http://fhir2.healthintersections.com.au/open";
	var patientID = "ad2f3d7c-4274-4422-a10a-8e2bc99c40";
	//var patientID = "example";
	
	var timeline = document.getElementById("cd-timeline");
	var patient = searchPatientID(url, patientID);
	var obs = searchResourcePatient(url, "Observation", patient);
	var patientName = patient.name[0].given[0] + " " + patient.name[0].family[0];
	changeHeader(patientName);
	for(i = 0; i < obs.length; i++)
	{
		var title = obs[i].code.coding[0].display;
		var content = obs[i].comments;
		var date = obs[i].effectiveDateTime;
		var img = "vertical-timeline/img/cd-icon-picture.svg";
		var block = generateBlock(title,content,date,img);
		timeline.appendChild(block);
	}

	var enc = searchResourcePatient(url, "Encounter", patient);
	for(i = 0; i < enc.length; i++)
	{
		var loc = retrieveReference(url,enc[i].location[0].location.reference);
		var title = loc.name;
		var content = enc[i].class;
		if(enc[i].period == undefined)
		{
			date = "";
		}
		else
		{
			var startRaw = enc[i].period.start;
			var endRaw = enc[i].period.end;
			var startEnd= startRaw.indexOf("T");
			var endEnd= endRaw.indexOf("T");
			var start = startRaw.substring(0,startEnd);
			var end = endRaw.substring(0,endEnd);
			var date = start + " - " + end;
		}
		
		var img = "vertical-timeline/img/cd-icon-movie.svg";
		var block = generateBlock(title,content,date,img);
		timeline.appendChild(block);
	}

	function changeHeader(newTitle)
	{
		document.getElementById("headline").innerHTML = newTitle;
	}
</script>
</body>
</html>