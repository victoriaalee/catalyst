<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href='http://fonts.googleapis.com/css?family=Droid+Serif|Open+Sans:400,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="vertical-timeline/css/reset.css"> <!-- CSS reset -->
	<link rel="stylesheet" href="vertical-timeline/css/style.css"> <!-- Resource style -->
	<script src="vertical-timeline/js/modernizr.js"></script> <!-- Modernizr -->
	
	<title>Patient Timeline</title>
</head>

<body>
	<header>
		<h1 id="headline">Responsive Vertical Timeline</h1>
	</header>
	
	<section>
		<ul>
			<li class="nav"><a href="#timeline">Timeline</a></li>
			<li class="nav"><a href="#background">Background</a></li>
			<li class="nav"><a href="#data">Data</a></li>
		</ul>
	<a name="timeline"/>

	
	</section>

	<a name="timeline"/>
	<div class="fillerbox"></div>
	<div class="section_header">Timeline</div>
		<p class="data_input">Keyword:</p>
		<input class="data_input" type="text" name="keyword" id="input1">
		<button class="data_input" onclick="timelineInput()">Submit</button>
	<section id="cd-timeline" class="cd-container">

		
	</section> 
	<a name="background"/>
	<div class="fillerbox"></div>
	<div class="section_header">Background</div>
	<div class="background_text">
		<p>
			Bob Griffin could see the image as clearly as if it had just happened. He had returned home from a

trip to the grocery store to find his wife Jane in a heap at the foot of their basement stairs. She had 

fallen and hit her head on the concrete flooring, was now semi-conscious, with a small pool of blood 

next to her head. Jane had undergone an emergency craniotomy to relieve the pressure a blood clot 

was putting on her brain. While the surgery eliminated the pressure, Jane’s walking was still unstable 

and she was having some difficulty speaking and swallowing. The medications for her chronic 

osteoarthritis and cardiovascular disease had to be crushed so Jane could swallow them.
		</p>
		<p>Jane’s primary care physician informed Bob that Jane would need rehabilitative services to regain her

ability to walk unassisted, restore her speech and swallow sufficiently to resume her normal diet. Given 

her current condition, he recommended Jane be transferred to a rehabilitation facility that was near 

their home. The location would make it easier for Bob to visit Jane and it had a history of being able 

to help people in Jane’s condition return to their former level of daily activities. The transfer occurred 

the following day and Bob met the physician, nurse and therapists who would be responsible for Jane’s 

care. He was encouraged by their prognosis for Jane, but it was painful to recount the details of her 

fall and frustrating to have to provide the date of her surgery, her allergies, current medications and 

other medical problems. He had been through all of this at the hospital – why didn’t they have all of 

this information?</p>
		<p>Thankfully, Jane made rapid progress. In three months she was able to walk with a cane, her speech

was almost back to normal and her swallowing had progressed to the point where she could return to 

her typical daily diet. She’d be discharged to home in a week. The home health company would send 

a therapist to make sure Jane didn’t have any issues navigating her home surroundings and was able 

to manage all of her daily activities, including her exercise plan to eliminate the need for the cane and 

further strengthen her swallowing muscles. Bob was looking forward to having Jane back home and 

no longer making the daily trip to the rehab facility. He just hoped he and Jane didn’t have to recount 

the background related to her fall and her medical history to another group of people.</p>
	</div>

	<a name="data"/>
	<div class="fillerbox"></div>
	<div class="section_header">Patient Data</div>
		<p class="data_input">Keyword:</p>
	<input class="data_input" type="text" name="keyword" id="input2">
	<button class="data_input" onclick="dataInput()">Submit</button>
	<div name="dataSection">

	</div>
	<script type="text/javascript">
 function dataInput(){
    var text=document.getElementById('input2').value;
 }
</script>
	<div class="fillerbox"></div>
	<!-- cd-timeline -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="vertical-timeline/js/main.js"></script> <!-- Resource jQuery -->
<script src="js/util.js"></script>
<script src="js/fhir.js"></script>
<script src="vertical-timeline/js/timeline.js"></script>
<script>
	var filter = "";
	var url = "http://fhir2.healthintersections.com.au/open";
	var patientID = "ad2f3d7c-4274-4422-a10a-8e2bc99c40";
	//var patientID = "example";
	
	var timeline = document.getElementById("cd-timeline");
	var data = document.getElementById("dataSection");

	var patient = searchPatientID(url, patientID);
	var patientName = patient.name[0].given[0] + " " + patient.name[0].family[0];
	changeHeader(patientName);

	var obs = searchResourcePatient(url, "Observation", patient);
	var enc = searchResourcePatient(url, "Encounter", patient);
	var aly= searchResourcePatient(url, "AllergyIntolerance", patient);
	var con = searchResourcePatient(url, "Condition", patient);

	var events = con.concat(aly.concat((enc.concat(obs))));
	var eventsContent = [];
	for(i = 0; i < events.length; i++)
	{
		eventsContent.push(generateContent(events[i]));
	}
	

	//////
	function removeChildren(dom)
	{
		while(dom.firstChild)
		{
			dom.removeChild(timeline.firstChild);
		}
	}

	function setTimeline(jsonObjects)
	{
		removeChildren(timeline);
		for(i = 0; i < jsonObjects.length; i++)
		{
			timeline.appendChild(blockGenJSON(jsonObjects[i]));
		}
	}

	function setData(jsonObjects)
	{
		removeChildren(timeline);
		for(i = 0; i < jsonObjects.length; i++)
		{
			data.appendChild(blockGenJSON(jsonObjects[i]));
		}
	}

	function changeHeader(newTitle)
	{
		document.getElementById("headline").innerHTML = newTitle;
	}

	//Generates a block based on the content strings
	function blockGenJSON(jsonData)
	{
		return blockGen(generateContent(jsonData));
	}
	function blockGen(contentStr)
	{
		var titleArray = contentStr.match("<e>(.+?)<\/e>");
		var contentArray = contentStr.match("<n>(.+?)<\/n>");
		var dateArray = contentStr.match("<t>(.+?)<\/t>");
		var title = titleArray!=null?titleArray[0]:"";
		var content = contentArray!=null?contentArray[0]:"";
		var date = dateArray!=null?dateArray[0]:"";
		return generateBlock(title,content,date);
	}

	//
	function timelineInput(){
    	filter = document.getElementById('input1').value;
    	var filtered = filterContent(events,eventsContent,filter);
    	setTimeline(filtered);
 	}
</script>
</body>
</html>